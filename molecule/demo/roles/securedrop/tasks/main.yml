---
- name: chown debian /srv
  file:
    path: /srv
    owner: debian
  become: True

- name: mkdir /srv/securedrop
  file:
    state: directory
    path: /srv/securedrop
    owner: debian
  become: True

- name: git clone -b {{ branch }} {{ repository }}
  git:
    repo: "{{ repository }}"
    version: "{{ branch }}"
    dest: "/srv/securedrop/{{ demo_name }}"

- name: install script
  template:
    src: check-securedrop-demo.sh
    dest: "/srv/securedrop/check-{{ demo_name }}.sh"
    mode: 0755

- name: install cron
  copy:
    src: "files/cronscript"
    dest: /usr/local/bin/cronscript
    owner: "{{ ansible_user }}"
    mode: 0755
  become: True

- name: install cron job
  cron:
    name: check securedrop demo
    minute: "*/5"
    job:  /usr/local/bin/cronscript
    user: "{{ ansible_user }}"
