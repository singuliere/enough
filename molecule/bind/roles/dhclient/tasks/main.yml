---
- name: cleanup old nameservers config
  lineinfile:
    path: /etc/dhcp/dhclient.conf
    line: "prepend domain-name-servers {{ hostvars['bind-host']['ansible_host'] }};"
    state: absent

- name: setup domain and search
  lineinfile:
    path: /etc/dhcp/dhclient.conf
    line: 'supersede {{ item.key }} {{ item.val }};'
  with_items:
    - key: "domain-name"
      val: '"{{dns_domain}}"'
    - key: "domain-search"
      val: '"{{dns_search}}"'
    - key: "domain-name-servers"
      val: "{{hostvars['bind-host']['ansible_host']}}"

- name: write /etc/resolv.conf once so it does not have to wait until the next dhclient update
  template:
    src: resolv.conf.j2
    dest: /etc/resolv.conf
