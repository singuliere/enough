---

- name: generate SSHFP records
  shell: |
      ssh-keygen -r {{ inventory_hostname }}
  register: cmd

- name: install SSHFP records
  blockinfile:
    content: "{{ hostvars[item].cmd.stdout }}"
    path: "/var/cache/bind/{{ domain }}"
    marker: ";; {mark} SSHFP records for {{ item }}"
    validate: 'named-checkzone -d {{ domain }} %s'
  delegate_to: bind-host
  notify: reload bind
  with_items:
    - "{{ ansible_play_batch }}"
  run_once: true
