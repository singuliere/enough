---
- name: Create /usr/local/share/ca-certificates/infrastructure when fake LE certs are used
  file:
    path: /usr/local/share/ca-certificates/infrastructure
    state: "{% if letsencrypt_nginx_staging | default(false) %}directory{% else %}absent{% endif %}"
    owner: root
    group: root
    mode: 0755
  notify: update-ca-certificates

- name: upload fake LE certs
  copy:
    src: "files/certs/{{ item }}"
    dest: "/usr/local/share/ca-certificates/infrastructure/{{ item | replace('.pem', '.crt') }}"
    owner: root
    group: root
    mode: 0644
  when: letsencrypt_nginx_staging | default(false)
  loop: "{{ letsencrypt_nginx_fake_le_certs }}"
  notify: update-ca-certificates
