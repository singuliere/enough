---
- name: setup fake LE
  hosts: nginx-host
  become: true

  roles:
    - role: letsencrypt-nginx
      vars:
        letsencrypt_nginx_staging: true
        letsencrypt_nginx_email: "contact-nginx@something.com"
        letsencrypt_nginx_fqdn: "{{ inventory_hostname }}.{{ domain }}"
        letsencrypt_nginx_sites: "# SOMETHING TESTS CAN GREP"

- name: setup reverse proxy fake LE
  hosts: proxy-host
  become: true

  roles:
    - role: letsencrypt-nginx
      vars:
        letsencrypt_nginx_staging: true
        letsencrypt_nginx_reverse_proxy: 127.0.0.1:8080
        letsencrypt_nginx_fqdn: "{{ inventory_hostname }}.{{ domain }}"

    - role: jdauphant.nginx
      vars:
        nginx_sites:
          backend:
            - |
              listen 8080;
              server_name _;
              root /tmp;

  tasks:
    - name: insert content in reverse proxy
      shell: echo SOMETHING > /tmp/index.html

- name: setup real LE
  hosts: bind-host
  become: true

  roles:
    - role: letsencrypt-nginx
      vars:
        letsencrypt_nginx_staging: false
        letsencrypt_nginx_email: "contact-bind@something.com"
        letsencrypt_nginx_fqdn: "{{ inventory_hostname }}.{{ domain }}"

- name: setup client
  hosts: client-host
  become: true

  roles:
    - role: letsencrypt-nginx
      vars:
        letsencrypt_nginx_staging: true
        letsencrypt_nginx_client: true
