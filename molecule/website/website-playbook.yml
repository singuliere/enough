---
- name: install website
  hosts: website-host
  become: true

  roles:
    - { role: website }

    - role: monitor_http_vhost
      http_vhost_name: Website
      http_vhost_fqdn: "{{ website_vhost_fqdn }}"
      http_vhost_uri: "/"
      http_vhost_string: "Enough"

# the repetition of play is intentional to avoid a weird bug https://paste2.org/HtmME4EV
# it may be happening only with ansible 2.4
- name: install letsencrypt on {{ website_vhost_fqdn }}
  hosts: website-host
  become: true

  roles:
    - role: letsencrypt-nginx
      vars:
        letsencrypt_nginx_fqdn: "{{ website_vhost_fqdn }}"

- name: install letsencrypt on www.{{ website_vhost_fqdn }}
  hosts: website-host
  become: true

  roles:
    - role: letsencrypt-nginx
      vars:
        letsencrypt_nginx_fqdn: "www.{{ website_vhost_fqdn }}"

