---
- name: apt-get install virtualenv
  apt:
    name: virtualenv
    state: present

- name: apt-get install python-pip
  apt:
    name: python-pip
    state: present

- name: pip install setuptools
  pip:
    name: setuptools

- name: pip install docker
  pip:
    name: docker

- name: pip install docker-compose
  pip:
    name: docker-compose

- name: Allow debian user to use docker without sudo
  user:
    name: debian
    groups: docker

- name: reset ssh connection to be in the docker group
  # ugly hack in replacement to
  # meta: reset_connection
  # The later fails in this way:
  # https://github.com/ansible/ansible/issues/27520#issuecomment-321966784
  local_action:
    module: file
    path: "~/.ansible/cp/{{ ansible_host }}-{{ ansible_port }}-{{ ansible_user }}"
    state: absent
  become: False
