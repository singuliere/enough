---
- name: apt-get install rsync, git, jdupes
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - rsync
    - git
    - jdupes

- name: chown debian /srv
  file:
    path: /srv
    owner: debian

- name: apt-get install haveged
  apt:
    name: haveged
    state: present

- name: GPG key creation batch
  copy:
    dest: /tmp/batch
    content: |
     %echo Generating a basic OpenPGP key
     Key-Type: RSA
     Key-Length: 4096
     Subkey-Type: ELG-E
     Subkey-Length: 4096
     Name-Real: SecureDrop test packages
     Name-Comment: with no passphrase
     Name-Email: contact@securedrop.club
     Expire-Date: 0
     %no-protection
     %commit

- name: create GPG key
  shell: |
    gpg --batch --generate-key /tmp/batch
  args:
    creates: /home/debian/.gnupg/trustdb.gpg
  become: False

- name: /var/www/html is owned by debian
  file:
    path: /var/www/html
    state: directory
    owner: debian

- name: update-packages.sh log file
  file:
    path: /var/log/update-packages.log
    state: touch
    owner: debian

- name: install /etc/logrotate.d/packages-logrotate
  copy:
    src: packages-logrotate
    dest: /etc/logrotate.d/packages-logrotate
