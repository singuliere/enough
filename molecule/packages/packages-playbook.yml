---
- name: install nginx
  hosts: packages-host

  roles:
    - role: jdauphant.nginx
      nginx_http_params:
        - access_log "/var/log/nginx/access.log"
      nginx_sites:
        default:
          - listen "{% if with_https is defined and with_https == true %}8080{% else %}80{% endif %}"
          - server_name _
          - root /var/www/html/

  tasks:
    - name: restart nginx
      shell: systemctl restart nginx

  become: True

- name: install packages
  hosts: packages-host

  roles:
    - { role: ansible-role-docker, docker_install_compose: false }
    - { role: docker }

    - { role: packages }

    - role: monitor_http_vhost
      http_vhost_name: Packages
      http_vhost_fqdn: "{{ packages_vhost_fqdn }}"
      http_vhost_uri: "/"
      http_vhost_status: 403
      http_vhost_string: "Forbidden"

  become: True
