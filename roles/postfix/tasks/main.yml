---
- name: debconf
  shell: |
    debconf-set-selections <<< "postfix postfix/mailname string mail.{{ domain }}"
    debconf-set-selections <<< "postfix postfix/main_mailer_type string 'Internet Site'"
  args:
    executable: /bin/bash
  changed_when: false

- name: apt-get install postfix
  apt:
    name: postfix
    state: present

- name: deconfigure postfix
  lineinfile:
    path: /etc/postfix/main.cf
    line: 'mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128'
    state: absent

- name: configure postfix
  lineinfile:
    path: /etc/postfix/main.cf
    line: 'mynetworks = 127.0.0.0/8 172.17.0.0/24 172.18.0.0/24:'
    state: present

- name: restart postfix
  systemd:
    name: postfix
    state: restarted
  changed_when: False
