---
- name: apt-get install git
  apt:
    name: git
    state: present

- name: chown debian /srv
  file:
    path: /srv
    owner: debian

- name: git clone https://github.com/jjethwa/icinga2
  git:
    repo: 'https://github.com/jjethwa/icinga2'
    force: yes
    dest: /srv/icinga2
  register: output
  changed_when: output.before != output.after

- name: Copy docker-compose.yml
  copy:
    src: files/docker-compose.yml
    dest: /srv/icinga2/docker-compose.yml
    mode: "0600"
  changed_when: false

- name: apt-get install virtualenv
  apt:
    name: virtualenv
    state: present

- name: apt-get install python-pip
  apt:
    name: python-pip
    state: present

- name: pip install setuptools
  pip:
    name: setuptools

- name: pip install docker
  pip:
    name: docker

- name: pip install docker-compose
  pip:
    name: docker-compose

- docker_service:
    project_src: /srv/icinga2
    state: present
